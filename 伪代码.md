# 第二问

## 第一小问

搜索直接找出路线

由于实际情况下有起点时刻信息和终点时刻信息，一定能够搜索到有效的路线

搜索过程必须把时间信息考虑在内来搜索？

如何避免搜索路径形成环？

### 输入

乘客编号,始发车站,目的地车站,进站刷卡时刻,出站刷卡时刻

### 输出

- 乘客编号, 始发车站, 进站时间， 列车1， 换乘站1， 换乘时间点， 列车2， 换乘站2， 换乘时间点 ... ， 目的地车站， 出站刷卡时刻

- 乘客 车站 进站时间 列车1 换乘站1 列车2 … 换乘站x 列车x 车站 出站时间


### 伪代码

```python

def get_solution(起点， 进站刷卡时刻， 终点， 出站刷卡时刻):
    # 将终点所在的路线设置为已被搜索过

    if 起点和终点在同一线路:
        for 终点的所有车次:
            if 该车次路线包含起点和终点, 且该车次到达终点的时间小于出站时刻， 该车次在起点的发车时间大于进站时刻:
                return (起点，终点， 车次号)

            for 包含终点的车次:
                取出该车次的最两边的顶点 vn1, vn2
                得到两边顶点的到达时间 ta1, ta2 

                if vn1 未被访问过 and ta1 > 进站刷卡时刻 and ta1 < 出站刷卡时刻:
                    将 vn1 置为已被被访问过
                    solution = get_solution(起点， 进站刷卡时刻， vn1, ta1)
                    if solution 有解：
                        return solution + (vn1, 终点， 车次) 
                    else
                        将 vn1 置为未被访问过

                
                if vn2 未被访问过 and ta2 > 进站刷卡时刻 and ta2 < 出站刷卡时刻:
                    将 vn2 置为已被被访问过
                    get_solution(起点， 进站刷卡时刻， vn2, ta2) 
                    if solution 有解：
                        return solution + (vn2, 终点， 车次) 
                    else
                        将 vn2 置为未被访问过               

    if 该线路存在换乘点:
        for 所有换乘点:
            for 该换乘点所有的车次:
                if 该车次路线包含换乘点和终点， 且该车次到达终点的时间小于出站时间:
                    得到该车次换乘点发车的时间 t1
                    if 换乘点发车的时间 t1 >= 终点时间 or t1 <= 起点时间
                        continue

                    将该换乘点置为已被搜索过

                    得到换乘站点的到达时间 t2
                    for 所有换乘前的站点 n2:
                        if n2 被搜索过
                            continue

                        将该换乘前的站点 n2 置为被搜索过

                        solution = get_solution(起点, 进站刷卡时间, 换乘前的站点 n2, 换乘站点的到达时间 t2)

                        if solution 有解:
                            return solution 拼接上 （换乘点信息 + 换乘点到终点的路线）
                        else:
                            将该换乘站点重置为未被搜索过
                            将该换乘前的站点 n2 重置为未被搜索过


    # 将该路线重置为未被搜索过
    return 无解

```


新版本伪代码

```python

def get_solution(起点， 进站刷卡时刻， 终点， 出站刷卡时刻):
    # 将终点所在的路线设置为已被搜索过

    if 起点和终点在同一线路:
        for 终点的所有车次:
            if 该车次路线包含起点和终点, 且该车次到达终点的时间 <= 出站时刻， 该车次在起点的发车时间 >= 进站时刻:
                return (起点，终点， 车次号)
            
        for 包含终点的车次:
            取出该车次的最两边的顶点 vn1, vn2
            得到两边顶点在该车次的到达时间 ta1, ta2 

            if vn1 未被访问过 and ta1 > 进站刷卡时刻 and ta1 < 出站刷卡时刻:
                将 vn1 置为已被被访问过
                solution = get_solution(起点， 进站刷卡时刻， vn1, ta1)
                if solution 有解：
                    return solution + (vn1, 终点， 车次) 
                else
                    将 vn1 置为未被访问过

            
            if vn2 未被访问过 and ta2 > 进站刷卡时刻 and ta2 < 出站刷卡时刻:
                将 vn2 置为已被被访问过
                get_solution(起点， 进站刷卡时刻， vn2, ta2) 
                if solution 有解：
                    return solution + (vn2, 终点， 车次) 
                else
                    将 vn2 置为未被访问过    
    
    if 该线路存在换乘点:
    选择经过终点的班次中，到达终点的时间最接近出站时间的前2个车次
        for 所有选择出来的可能班次:
            for 该线路所有换乘点:
                if 该换乘点被搜索过:
                    continue
                    
                if 该车次经过换乘点
                    if 该车次在换乘点的到达时间大于终止时间，或者发车时间小于起始时间， 或者到达时间小于该车次在终止点的到达时间:
                        continue

                    将该换乘点置为已被搜索过

                    得到换乘站点的到达时间 t2；将该时间作为新的出站时间
                    for 所有换乘前的站点 n2:
                        if n2 被搜索过
                            continue

                        将该换乘前的站点 n2 置为被搜索过

                        solution = get_solution(起点, 进站刷卡时间, 换乘前的站点 n2, 换乘站点的到达时间 t2)

                        if solution 有解:
                            return solution 拼接上 （换乘点信息 + 换乘点到终点的路线）
                        else:
                            将该换乘站点重置为未被搜索过
                            将该换乘前的站点 n2 重置为未被搜索过


    # 将该路线重置为未被搜索过
    return 无解

```

### 程序输出

1. 路线结果
    
    (一个线路的起点， 该线路的终点(换乘点或者终点)， 车次)

    <!-- (换乘点， 换乘后的点, None) -->

    示例: `[('19', '12', '106093'), ('41', '51', '211109'), ('253', '251', '1353087')]`

2 2.A 最终的输出

    乘客编号, 进站时间， 始发车站, 乘车时间， 几号线,  列车1， 换乘站1， 乘车时间点，几号线,  列车2， 换乘站2，... ， 乘车时间点，几号线,  列车号， 目的地车站， 出站刷卡时刻

3. 求用户的行程距离的输出

    乘客编号, 起始站点，中间经过的站点， ..., 换乘站点（可能有）, 中间站点, ..., 中间站点, 终止点，总路程长度


((起点站， 换乘站1， 车次号)， (换乘站1， 换乘站2, 车次号)， ...， (换乘站x, 换乘站x, 车次号)， ... ， (换乘站n, 终点站, 车次号) )

